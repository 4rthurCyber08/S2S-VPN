# Certificates

## CA Hierarchy

1. ROOT CA
   - X509v3
   - Basic Constraints [Critical]
       CA
   - Key Usage [Critical]
       Certificate Sign
       CRL Sign

<br>

2. SUB CA
   - X509v3
   - Basic Constraints [Critical]
       CA
	   Path Len: 0
   - Key Usage [Critical]
       Certificate Sign
       CRL Sign

<br>

3. LEAF CA
   - X509v3
   - Basic Constraints [Critical]
       END-ENTITY
   - Extensions
       Subject Alt Names
   - Key Usage [Critical]
       Digital Signature
	   Key Encipherment
	   Data Encipherment
	   Key Agreement
   - Extended Key Usage
       TLS Web Server Authentication
       TLS Web Client Authentication	   
	   E-mail Protection
	   IPSec End System
	   IPSec Tunnel
	   IPSec User
	   IP Security end entity


<br>
<br>

---
&nbsp; 


## Certificates via XCA

### STEP 1. Set a domain name for clients
 
~~~
!@Cisco
conf t
 ip domain name RIVANPH.COM
 end
~~~


<br>
<br>

---
&nbsp; 


### STEP 2. Import the ROOT CA

~~~ 
!@Cisco
conf t
 crypto pki trustpoint RIVAN-CA
  enrollment terminal
  revocation-check crl none
  exit
 !
 crypto pki authenticate RIVAN-CA
~~~


<br>
<br>

---
&nbsp;


### STEP 3. Generate CSR

~~~
!@Cisco
conf t
 crypto pki trustpoint RIVANPH
  enrollment terminal
  exit
 !
 crypto pki enroll RIVANPH
 !
 
~~~


<br>


__PEM Header & Footer__  

-----BEGIN CERTIFICATE REQUEST-----

-----END CERTIFICATE REQUEST-----


<br>


~~~
!@Cisco
conf t
 crypto pki authenticate RIVANPH
~~~
 

<br>
<br>

---
&nbsp;


### STEP 4. Import the Signed CSR

~~~
!@Cisco
conf t
 crypto pki import RIVANPH certificate
 end
~~~


<br>
<br>

---
&nbsp;
 
 
## S2S VPN (CERT)
 
### STEP 1. GRE Tunnel Properties

~~~
!@UTM-PH
conf t
 int tun1
  ip add __.__.__.__   __.__.__.__
  tunnel source __
  tunnel destination __.__.__.__
  tunnel mode gre ip
  end
~~~


~~~
!@UTM-JP
conf t
 int tun1
  ip add __.__.__.__   __.__.__.__
  tunnel source __
  tunnel destination __.__.__.__
  tunnel mode gre ip
  end
~~~


<br>
<br>


### STEP 2. Routing Interesting traffic/Remote Subnets

~~~
!@UTM-PH
conf t
 ip route __.__.__.__   __.__.__.__   __.__.__.__
 end
~~~


~~~
!@UTM-JP
conf t
 ip route __.__.__.__   __.__.__.__   __.__.__.__
 end
~~~


<br>
<br>


### STEP 3. Configure IKE PHASE 1

~~~
!@UTM-PH, UTM-JP
conf t
 crypto isakmp policy 1
  authentication  ___
  encryption ___  ___
  hash  ___
  group ___
  end
~~~


<br>
<br>


### STEP 4. Configure IPSec PHASE 2

~~~
!@UTM-PH, UTM-JP
conf t
 crypto ipsec transform-set IPSECTUNNEL ___-___  ___  ___-___-___
  mode transport
  exit
 crypto ipsec profile RIVAN
  set transform-set IPSECTUNNEL
  set pfs group14
  end
~~~


<br>
<br>


### STEP 5. Apply IPSec Profile Protection to Tunnel

~~~
!@UTM-PH, UTM-JP
conf t
 int tunnel 1
  tunnel protection ipsec profile RIVAN 
  end
~~~


<br>
<br>


### Verification

~~~
!@UTM-PH, UTM-JP
show crypto isakmp sa
show crypto ipsec sa

~~~
